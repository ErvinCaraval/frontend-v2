import{u as Q,r,j as e,a as U}from"./index-D5d0iPnG.js";/* empty css                            */const K=({topics:v,onQuestionCreated:q,onCancel:l})=>{const{user:f}=Q(),[m,R]=r.useState(""),[y,b]=r.useState(["","","",""]),[p,N]=r.useState(0),[T,B]=r.useState(v[0]||""),[I,h]=r.useState(""),[S,C]=r.useState(!1),j=(n,s)=>{const g=[...y];g[n]=s,b(g)},E=async n=>{if(n.preventDefault(),h(""),!m.trim()||y.some(s=>!s.trim())){h("Completa la pregunta y todas las opciones.");return}if(!f||!f.getIdToken){h("Debes iniciar sesión para crear preguntas.");return}C(!0);try{const s="https://backend-v1-2nej.onrender.com";let g=await f.getIdToken();const F={text:m,options:y,correctAnswerIndex:p,category:T,explanation:""},A=await fetch(`${s}/api/questions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`},body:JSON.stringify(F)}),k=await A.json();A.ok&&k.success!==!1?q&&q(k.question||{question:m,options:y,correctAnswerIndex:p,category:T}):h(k.error||"Error al guardar la pregunta")}catch{h("Error de conexión")}finally{C(!1)}};return e.jsxs("form",{className:"manual-question-form",onSubmit:E,children:[e.jsx("h3",{children:"Escribe tu pregunta"}),e.jsxs("label",{children:["Tema:",e.jsx("select",{value:T,onChange:n=>B(n.target.value),children:v.map(n=>e.jsx("option",{value:n,children:n},n))})]}),e.jsxs("label",{children:["Pregunta:",e.jsx("input",{type:"text",value:m,onChange:n=>R(n.target.value),required:!0})]}),e.jsxs("div",{children:["Opciones:",e.jsx("div",{className:"manual-options-list",children:y.map((n,s)=>e.jsxs("div",{className:"manual-option-row",children:[e.jsx("input",{type:"text",value:n,onChange:g=>j(s,g.target.value),required:!0,placeholder:`Opción ${s+1}`}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"correctOption",checked:p===s,onChange:()=>N(s)}),"Correcta"]})]},s))})]}),I&&e.jsx("div",{className:"error-message",children:I}),e.jsxs("div",{className:"manual-question-actions",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:l,disabled:S,style:{minWidth:100,fontSize:"1.08rem",whiteSpace:"nowrap"},children:"Atrás"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:S,style:{minWidth:140,fontSize:"1.08rem",whiteSpace:"nowrap"},children:S?"Guardando...":"Guardar"})]})]})},ee=({onQuestionsGenerated:v,onClose:q})=>{const{user:l}=Q();U();const[f,m]=r.useState([]),[R,y]=r.useState([]),[b,p]=r.useState(""),[N,T]=r.useState("medium"),[B,I]=r.useState(5),[h,S]=r.useState(!1),[C,j]=r.useState(!1),[E,n]=r.useState(1),[s,g]=r.useState(0),[F,A]=r.useState([]),[k,L]=r.useState(""),[W,w]=r.useState(!1),[D,o]=r.useState(""),[P,J]=r.useState([]),[X,Y]=r.useState(!1);r.useEffect(()=>{G(),V()},[]);const G=async()=>{try{const x=await(await fetch("https://backend-v1-2nej.onrender.com/api/ai/topics")).text();let a;try{a=JSON.parse(x)}catch{m([]),p(""),o("Respuesta inválida del backend."),console.error("Respuesta no es JSON:",x);return}a.success&&Array.isArray(a.topics)&&a.topics.length>0?(m(a.topics),p(a.topics[0])):(m([]),p(""),o(`No hay temas disponibles. Respuesta: ${JSON.stringify(a)}`),console.error("Respuesta inesperada:",a))}catch(t){m([]),p(""),o("Error obteniendo temas. Detalle consola."),console.error("Error fetching topics:",t)}},V=async()=>{try{const x=await(await fetch("https://backend-v1-2nej.onrender.com/api/ai/difficulty-levels")).json();x.success&&y(x.levels)}catch(t){console.error("Error fetching difficulty levels:",t)}},H=async()=>{if(!b){o("Por favor selecciona un tema válido");return}w(!0),o("");try{const t="https://backend-v1-2nej.onrender.com",c=l&&l.getIdToken?await l.getIdToken():null,a=await(await fetch(`${t}/api/ai/generate-questions`,{method:"POST",headers:{"Content-Type":"application/json",...c?{Authorization:`Bearer ${c}`}:{}},body:JSON.stringify({topic:b,difficulty:N,count:B,useAI:h})})).json();if(console.log("Respuesta de /api/ai/generate-questions:",a),a.success){const z=a.questions.map(d=>({...(()=>{if(!Array.isArray(d.options)||typeof d.correctAnswerIndex!="number")return d;const u=d.options.map((i,M)=>({opt:i,origIdx:M}));for(let i=u.length-1;i>0;i--){const M=Math.floor(Math.random()*(i+1));[u[i],u[M]]=[u[M],u[i]]}const O=u.findIndex(i=>i.origIdx===d.correctAnswerIndex);return{...d,options:u.map(i=>i.opt),correctAnswerIndex:O}})(),createdBy:(l==null?void 0:l.uid)||"anon",createdAt:Date.now(),category:b,difficulty:N}));let $=!1;try{const d=l&&l.getIdToken?await l.getIdToken():null,O=await(await fetch(`${t}/api/questions/bulk`,{method:"POST",headers:{"Content-Type":"application/json",...d?{Authorization:`Bearer ${d}`}:{}},body:JSON.stringify({questions:z})})).json();O.success?$=!0:(o(i=>(i?i+" | ":"")+(O.error||"Error guardando preguntas en Firestore")),console.error("Error guardando preguntas en Firestore:",O.error))}catch(d){o(u=>(u?u+" | ":"")+"Error guardando preguntas en Firestore"),console.error("Error guardando preguntas en Firestore:",d)}if(!$){w(!1);return}v(a.questions),w(!1)}else o(a.error||"Error generando preguntas"),console.error("Error generando preguntas:",a.error)}catch(t){o("Error de conexión. Intenta nuevamente."),console.error("Error generating questions:",t)}finally{w(!1)}};return r.useEffect(()=>{!W&&!D&&P.length===0&&I(5)},[W,D,P]),e.jsx("div",{className:"ai-generator-overlay",children:e.jsxs("div",{className:"ai-generator-modal",children:[e.jsxs("div",{className:"ai-generator-header",children:[e.jsx("h2",{children:"🤖 Generador de Preguntas"}),e.jsx("button",{className:"close-btn",onClick:q,children:"×"})]}),!C&&!h&&e.jsxs("div",{className:"ai-generator-method-select",children:[e.jsx("button",{className:"btn btn-primary",onClick:()=>S(!0),style:{marginRight:12,minWidth:140,fontSize:"1.08rem",whiteSpace:"nowrap"},children:"Crear con IA"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>j(!0),style:{minWidth:140,fontSize:"1.08rem",whiteSpace:"nowrap"},children:"Escribir preguntas"})]}),h&&!C&&e.jsxs("form",{className:"ai-generator-form",onSubmit:async t=>{t.preventDefault(),w(!0),o("");try{await H(),o("")}catch{o("Error al generar preguntas. Por favor, inténtalo de nuevo.")}finally{w(!1)}},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"topic",children:"Tema"}),e.jsx("select",{id:"topic",className:"form-select",value:b,onChange:t=>p(t.target.value),disabled:f.length===0,children:f.length===0?e.jsx("option",{value:"",children:"No hay temas disponibles"}):f.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"difficulty",children:"Dificultad"}),e.jsxs("select",{id:"difficulty",className:"form-select",value:N,onChange:t=>T(t.target.value),children:[e.jsx("option",{value:"easy",children:"Fácil"}),e.jsx("option",{value:"medium",children:"Media"}),e.jsx("option",{value:"hard",children:"Difícil"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"numQuestions",children:"Cantidad de Preguntas"}),e.jsx("input",{id:"numQuestions",className:"form-input",type:"number",min:1,max:20,value:B,onChange:t=>I(Number(t.target.value)),required:!0})]}),D&&e.jsx("div",{className:"error-message",children:D}),e.jsxs("div",{className:"ai-generator-actions",children:[e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:W,style:{minWidth:140,fontSize:"1.08rem",whiteSpace:"nowrap"},children:W?"Creando...":"Crear preguntas"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>S(!1),disabled:W,style:{marginLeft:8,minWidth:100,fontSize:"1.08rem",whiteSpace:"nowrap"},children:"Atrás"})]})]}),C&&e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:380,padding:"32px 0 12px 0",animation:"fadeIn .5s"},children:s===0?e.jsxs("form",{className:"manual-question-form",style:{maxWidth:420,margin:"0 auto",marginBottom:24,boxShadow:"0 8px 32px rgba(42,122,228,0.13)",background:"rgba(26,26,46,0.97)",borderRadius:24,padding:"36px 32px 28px 32px",border:"2.5px solid var(--bb-primary)",backdropFilter:"blur(14px) saturate(1.2)"},onSubmit:t=>{t.preventDefault(),g(1),A([]),L(b)},children:[e.jsx("h3",{style:{textAlign:"center",marginBottom:24,fontWeight:900,fontSize:"1.35rem",letterSpacing:1.2,color:"var(--bb-primary)",background:"var(--bb-gradient-primary)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"¿Cuántas preguntas quieres agregar manualmente?"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:22},children:[e.jsxs("label",{style:{fontSize:"1.08rem",fontWeight:600},children:["Tema:",e.jsx("select",{value:b,onChange:t=>p(t.target.value),style:{marginLeft:8,minWidth:120,padding:"10px 16px",borderRadius:10,fontSize:"1.08rem",border:"2px solid var(--bb-primary-light)",background:"rgba(22,33,62,0.7)",color:"var(--bb-text-primary)"},children:f.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("label",{style:{fontSize:"1.08rem",fontWeight:600},children:["¿Cuántas preguntas?",e.jsx("input",{type:"number",min:1,max:50,value:E,onChange:t=>n(Number(t.target.value)),style:{marginLeft:8,width:90,padding:"10px 16px",borderRadius:10,fontSize:"1.08rem",border:"2px solid var(--bb-primary-light)",background:"rgba(22,33,62,0.7)",color:"var(--bb-text-primary)"},required:!0})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:18,marginTop:10},children:[e.jsx("button",{type:"submit",className:"btn btn-primary",style:{minWidth:120,fontSize:"1.08rem"},children:"Empezar"}),e.jsx("button",{type:"button",className:"btn btn-secondary",style:{minWidth:120,fontSize:"1.08rem"},onClick:()=>j(!1),children:"Volver"})]})]})]}):e.jsxs("div",{style:{width:"100%",maxWidth:650,margin:"0 auto",background:"rgba(26,26,46,0.97)",borderRadius:28,boxShadow:"0 8px 32px rgba(42,122,228,0.13)",border:"2.5px solid var(--bb-primary)",padding:"36px 32px 28px 32px",backdropFilter:"blur(14px) saturate(1.2)",animation:"fadeIn .5s"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:18,fontWeight:900,fontSize:"1.25rem",letterSpacing:1.1,color:"var(--bb-primary)",background:"var(--bb-gradient-primary)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:["¡Vamos! Pregunta ",F.length+1," de ",E]}),e.jsx(K,{topics:[k],onQuestionCreated:t=>{const c=F.concat([{...t,category:k}]);if(c.length<E)A(c),g(s+1);else{const x="https://backend-v1-2nej.onrender.com";l.getIdToken().then(a=>{fetch(`${x}/api/questions/bulk`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({questions:c})}).then(z=>z.json()).then(z=>{j(!1),o(""),J($=>[...$,...c]),v&&v(c)}).catch(()=>{o("Error guardando preguntas en Firestore"),j(!1)})})}},onCancel:()=>j(!1)})]})})]})})};export{ee as default};
//# sourceMappingURL=AIQuestionGenerator-DOtiIo6i.js.map
