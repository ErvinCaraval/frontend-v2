import{j as e,r as n,e as F,u as $,a as V}from"./index-D5d0iPnG.js";import{s as t}from"./socket-q9tp1uyO.js";/* empty css                            */import{R as K}from"./Ranking-CENtxIkT.js";function L({question:l,options:c,onSelect:a,selected:s}){return e.jsxs("div",{className:"question-card",children:[e.jsx("h2",{className:"question-title",children:l}),e.jsx("div",{className:"options-list",children:c.map((i,o)=>e.jsxs("button",{className:`option-btn${s===o?" selected":""}`,onClick:()=>a(o),disabled:s!==null,children:[e.jsxs("span",{className:"option-label",children:[String.fromCharCode(65+o),")"]})," ",i]},o))})]})}function J({seconds:l=20,onEnd:c,onTick:a}){const[s,i]=n.useState(l),o=n.useRef();n.useEffect(()=>{i(l)},[l]),n.useEffect(()=>{if(s===0){c&&c();return}return o.current=setInterval(()=>{i(N=>N-1)},1e3),()=>clearInterval(o.current)},[s,c]),n.useEffect(()=>{a&&a(s)},[s,a]);const g=()=>s<=3?"critical":s<=6?"warning":"normal";return e.jsxs("div",{className:`timer ${g()}`,children:[e.jsx("div",{className:"timer-circle",children:e.jsx("span",{className:"timer-text",children:s})}),e.jsx("span",{className:"timer-label",children:"segundos restantes"})]})}function M(){const[l,c]=n.useState(!1),{gameId:a}=F(),{user:s}=$(),[i,o]=n.useState(null),[g,N]=n.useState(0),[v,Q]=n.useState(0),[m,w]=n.useState(null),[y,I]=n.useState([]),[S,b]=n.useState(!1),[h,k]=n.useState(null),[q,G]=n.useState(0),[W,P]=n.useState(10),R=V();n.useEffect(()=>{if(s&&a&&(t.emit("requestQuestion",{gameId:a}),console.log("[GamePage] Emitiendo requestQuestion:",{gameId:a})),setTimeout(()=>{i||c(!0)},5e3),!s)return;t.connected||(console.log("[GamePage] Intentando conectar socket..."),t.connect());function u(){console.log("[GamePage] Socket conectado:",t.id)}function f({question:r,index:x}){console.log("[GamePage] Evento newQuestion recibido:",r),Array.isArray(r.options)||(r.options=[]),o({...r,options:[...r.options]}),N(x),w(null),b(!1),P(10),G(j=>j+1)}function d({correctAnswerIndex:r,explanation:x,players:j}){console.log("[GamePage] Evento answerResult recibido:",{correctAnswerIndex:r,explanation:x,players:j}),b(!0),k({correctAnswerIndex:r,explanation:x}),I(j)}function p({players:r}){console.log("[GamePage] Evento gameFinished recibido:",r),R(`/summary/${a}`,{state:{players:r}})}function E({questionsCount:r}){console.log("[GamePage] Evento gameStarted recibido:",r),Q(r)}return t.on("connect",u),t.on("newQuestion",f),t.on("answerResult",d),t.on("gameFinished",p),t.on("gameStarted",E),()=>{t.off("connect",u),t.off("newQuestion",f),t.off("answerResult",d),t.off("gameFinished",p),t.off("gameStarted",E)}},[s,a,R]);const T=n.useCallback(u=>{if(m!==null)return;w(u);const f=i&&Array.isArray(i.options)?i.options[u]:void 0;t.emit("submitAnswer",{gameId:a,uid:s.uid,answerIndex:u,answerValue:f})},[a,s,m]),A=n.useCallback(()=>{m===null&&t.emit("submitAnswer",{gameId:a,uid:s.uid,answerIndex:null,answerValue:null})},[a,s,m]),C=()=>[...y].sort((d,p)=>p.score-d.score).findIndex(d=>d.uid===s.uid)+1;return e.jsxs("div",{className:"game-page",children:[e.jsxs("header",{className:"game-header",children:[e.jsxs("div",{className:"game-info",children:[e.jsx("h2",{children:"ðŸŽ¯ Juego de Preguntas"}),e.jsxs("div",{className:"progress-info",children:[e.jsxs("span",{className:"question-counter",children:["Pregunta ",g+1," de ",v||"?"]}),e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${(g+1)/(v||1)*100}%`}})})]})]}),e.jsxs("div",{className:"player-rank",children:[e.jsxs("span",{className:"rank-number",children:["#",C()]}),e.jsx("span",{className:"rank-label",children:"Tu posiciÃ³n"})]})]}),e.jsxs("main",{className:"game-main",children:[i&&e.jsxs("div",{className:"question-container",children:[e.jsxs("div",{className:"question-header",children:[e.jsx(L,{question:i.question,options:i.options,onSelect:T,selected:m}),!S&&e.jsx(J,{seconds:10,onEnd:A,onTick:P},q)]}),S&&h&&e.jsxs("div",{className:"result-container",children:[e.jsx("div",{className:"result-header",children:e.jsx("h4",{children:"âœ… Â¡Respuesta revelada!"})}),e.jsxs("div",{className:"correct-answer",children:[e.jsx("strong",{children:"Respuesta correcta:"})," ",i.options[h.correctAnswerIndex]]}),h.explanation&&e.jsxs("div",{className:"explanation",children:[e.jsx("strong",{children:"ExplicaciÃ³n:"})," ",h.explanation]})]})]}),!i&&!l&&e.jsxs("div",{className:"waiting-container",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Esperando la siguiente pregunta..."})]}),!i&&l&&e.jsxs("div",{className:"waiting-container",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{style:{color:"red",fontWeight:"bold"},children:"No se encontraron preguntas para este tema. Verifica que hayas generado preguntas y que el tema coincida exactamente."})]})]}),e.jsx("aside",{className:"game-sidebar",children:e.jsx(K,{players:y})})]})}export{M as default};
//# sourceMappingURL=GamePage-DlHGqA7x.js.map
